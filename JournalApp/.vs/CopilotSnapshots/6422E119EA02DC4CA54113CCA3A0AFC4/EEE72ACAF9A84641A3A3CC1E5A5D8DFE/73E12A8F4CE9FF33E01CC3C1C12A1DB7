using SQLite;
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace JournalApp.Models
{
    public class JournalEntry
    {
        [PrimaryKey, AutoIncrement]
        public int Id { get; set; }

        [Required]
        public string Title { get; set; } = string.Empty;

        [Required]
        public string Content { get; set; } = string.Empty;

        public DateTime Date { get; set; } = DateTime.Today;
        public bool IsLocked { get; set; } = false;
        public string? PinHash { get; set; }

        // Timestamps
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime UpdatedAt { get; set; } = DateTime.Now;

        // Mood Tracking
        public string PrimaryMood { get; set; } = "Neutral";
        public string SecondaryMoods { get; set; } = string.Empty; // Comma-separated values

        // Tags
        public string Tags { get; set; } = string.Empty; // Comma-separated tags

        // Helper methods for moods
        public List<string> GetSecondaryMoodsList() => 
            string.IsNullOrEmpty(SecondaryMoods) ? new List<string>() : 
            SecondaryMoods.Split(',').Select(s => s.Trim()).Where(s => !string.IsNullOrEmpty(s)).ToList();

        public void SetSecondaryMoods(IEnumerable<string> moods) => 
            SecondaryMoods = string.Join(",", moods.Take(2)); // Max 2 secondary moods

        public bool HasSecondaryMood(string mood) => 
            GetSecondaryMoodsList().Contains(mood, StringComparer.OrdinalIgnoreCase);

        public void ToggleSecondaryMood(string mood)
        {
            var moods = GetSecondaryMoodsList();
            if (moods.Contains(mood, StringComparer.OrdinalIgnoreCase))
                moods.RemoveAll(m => string.Equals(m, mood, StringComparison.OrdinalIgnoreCase));
            else if (moods.Count < 2)
                moods.Add(mood);
            SetSecondaryMoods(moods);
        }
    }
}
